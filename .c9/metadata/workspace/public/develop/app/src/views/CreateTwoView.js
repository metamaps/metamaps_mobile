{"changed":true,"filter":false,"title":"CreateTwoView.js","tooltip":"/public/develop/app/src/views/CreateTwoView.js","value":"/* globals define */\ndefine(function(require, exports, module) {\n    'use strict';\n    // import dependencies\n    var Engine = require('famous/core/Engine');\n    var Modifier = require('famous/core/Modifier');\n    var Transform = require('famous/core/Transform');\n    var Surface = require('famous/core/Surface');\n    var View = require('famous/core/View');\n    var ImageSurface = require('famous/surfaces/ImageSurface');\n    var MediaInputSurface = require('surfaces/MediaInputSurface');\n    var AudioRecorder = require('audio/AudioRecorder');\n\n    // the goal\n    // https://plus.google.com/u/0/photos/116559944503510939534/albums/6009798305267426977/6009798312345768402?pid=6009798312345768402&oid=116559944503510939534\n\n    function CreateView() {\n        View.apply(this, arguments);\n\n        _createRecorder.call(this);\n        _createImageCapture.call(this);\n        _createSubmit.call(this);\n        \n    }\n\n    CreateView.prototype = Object.create(View.prototype);\n    CreateView.prototype.constructor = CreateView;\n\n\n    function _createRecorder() {\n        var mod = new Modifier({\n            origin: [0, 1]\n        });\n        \n        this.recordSurface = new Surface({\n            size: [100, 100], //window.innerWidth, window.innerHeight / 5],\n            content: '<button>Record</button>',\n            properties: {\n                backgroundColor: 'red'\n            }\n        });\n        \n        // start recording\n        this.recordSurface.on('touchstart', function(e) {\n    \t\tvar that = this;\n    \t    \n    \t\tvar timeLapsed = Date.now();\n            that.recordSurface.setContent(Math.floor((Date.now()-timeLapsed)/1000));\n            \n            this.recordingMessage = setInterval(function(){\n                that.recordSurface.setContent(Math.floor((Date.now()-timeLapsed)/1000));\n            }, 1000);\n            \n            this.recordSurface.setProperties({backgroundColor: 'green'});\n            \n            AudioRecorder.start();\n            \n        }.bind(this));\n        // stop recording\n        this.recordSurface.on('touchend', function(e) {\n            this.recordSurface.setContent(\"<button>Record</button>\");\n            this.recordSurface.setProperties({backgroundColor: 'red'});\n            \n            clearInterval(this.recordingMessage);\n            \n            AudioRecorder.stop(function(blob) {\n                console.log(blob);\n                this.audioFile = blob;\n                this.audioFile.name = Date.now() + \".wav\";\n                \n            }.bind(this));\n        }.bind(this));\n\n        this._add(mod).add(this.recordSurface);\n    }\n\n    \n    function _createImageCapture() {\n        var mod = new Modifier({\n            origin: [1, 1]\n        });\n        \n        var mod2 = new Modifier({\n            origin: [1, 1]\n        });\n        \n        this.imagePreview = new ImageSurface({\n            size: [100, 100]\n        });\n        \n        this.imageInput = new MediaInputSurface({\n            size: [100, 100],\n            properties: {\n                // Hide the button that does the actual work\n                opacity: \"0.0\"\n            },\n            type: 'file',\n            accept: 'image/*',\n            capture: 'camera'\n        });\n        \n        this.imageInput.on('change', this.previewFile.bind(this));\n\n        this._add(mod).add(this.imagePreview);\n        this._add(mod2).add(this.imageInput);\n    }\n\n\n    function _createSubmit() {\n        var mod = new Modifier({\n            origin: [1, 0]\n        });\n        \n        this.submitSurface = new Surface({\n            size: [100, 50],\n            content: '<button>Send!</button>'\n        });\n        \n        this.submitSurface.on('click', function(e) {\n            //var file = this.imageInput._currTarget.files[0];\n            \n            if (this.audioFile) {\n                this.uploadFile(this.audioFile);\n            }\n            \n            //this.uploadFile(file);\n            \n        }.bind(this));\n\n        this._add(mod).add(this.submitSurface);\n    }\n\n    CreateView.prototype.previewFile = function(ev) {\n        var file = ev.origin._currTarget.files[0];\n        var reader = new FileReader();\n        if (file.type.indexOf(\"image\") == 0) {\n            reader.onload = function(e) {\n                this.imagePreview.setContent(e.target.result);\n            }.bind(this)\n            reader.readAsDataURL(file);\n        }\n    }\n\n    CreateView.prototype.uploadFile = function(file) {\n        // var file = document.getElementById(\"fileselect\");\n        var xhr = new XMLHttpRequest();\n        if (xhr.upload) {\n            // file received/failed\n            xhr.onreadystatechange = function(e) {\n                if (xhr.readyState == 4) {\n                    var message = xhr.status == 200 ? \"success\" : \"failure\";\n                    console.log(message);\n                }\n            };\n            // start upload\n            xhr.open(\"POST\", \"/upload\", true);\n            xhr.setRequestHeader(\"X-File-Name\", file.name);\n            xhr.send(file);\n            console.log(\"sent file!\");\n        }\n    }\n    module.exports = CreateView;\n});\n    ","undoManager":{"mark":75,"position":100,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":141,"column":14},"end":{"row":141,"column":15}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":141,"column":15},"end":{"row":141,"column":16}},"text":"b"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":141,"column":16},"end":{"row":141,"column":17}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":141,"column":17},"end":{"row":141,"column":18}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":141,"column":18},"end":{"row":141,"column":19}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":119,"column":33},"end":{"row":120,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":120,"column":0},"end":{"row":120,"column":16}},"text":"                "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":16},"end":{"row":120,"column":22}},"text":"thiis."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":120,"column":19},"end":{"row":120,"column":22}},"text":"is."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":19},"end":{"row":120,"column":22}},"text":"s.a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":22},"end":{"row":120,"column":23}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":23},"end":{"row":120,"column":25}},"text":"di"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":25},"end":{"row":120,"column":30}},"text":"oFile"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":30},"end":{"row":120,"column":34}},"text":".nam"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":34},"end":{"row":120,"column":36}},"text":"e "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":120,"column":36},"end":{"row":120,"column":38}},"text":"= "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":67,"column":38},"end":{"row":68,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":68,"column":0},"end":{"row":68,"column":16}},"text":"                "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":16},"end":{"row":69,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":69,"column":0},"end":{"row":69,"column":16}},"text":"                "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":16},"end":{"row":68,"column":21}},"text":"this."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":21},"end":{"row":68,"column":23}},"text":"ad"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":68,"column":22},"end":{"row":68,"column":23}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":22},"end":{"row":68,"column":26}},"text":"udio"},{"action":"removeText","range":{"start":{"row":68,"column":21},"end":{"row":68,"column":26}},"text":"audio"},{"action":"insertText","range":{"start":{"row":68,"column":21},"end":{"row":68,"column":31}},"text":"audioFile."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":31},"end":{"row":68,"column":36}},"text":"name "},{"action":"insertText","range":{"start":{"row":68,"column":36},"end":{"row":68,"column":38}},"text":"= "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":38},"end":{"row":68,"column":41}},"text":"\"b\""}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":40},"end":{"row":68,"column":41}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":41},"end":{"row":68,"column":43}},"text":"ah"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":43},"end":{"row":68,"column":45}},"text":".w"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":45},"end":{"row":68,"column":46}},"text":"a"},{"action":"insertText","range":{"start":{"row":68,"column":46},"end":{"row":68,"column":47}},"text":"v"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":48},"end":{"row":68,"column":49}},"text":";"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":122,"column":0},"end":{"row":123,"column":0}},"nl":"\n","lines":["                this.audioFile.name = "]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":143,"column":19},"end":{"row":143,"column":20}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":143,"column":20},"end":{"row":143,"column":21}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":143,"column":21},"end":{"row":143,"column":22}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":143,"column":22},"end":{"row":143,"column":23}},"text":"f"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":143,"column":23},"end":{"row":143,"column":24}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"/"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":22,"column":9},"end":{"row":22,"column":10}},"text":"/"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":143,"column":24},"end":{"row":143,"column":25}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":143,"column":25},"end":{"row":143,"column":26}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":145,"column":20},"end":{"row":145,"column":21}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":145,"column":19},"end":{"row":145,"column":20}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":145,"column":19},"end":{"row":145,"column":20}},"text":"5"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":145,"column":20},"end":{"row":145,"column":21}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":145,"column":24},"end":{"row":145,"column":25}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":145,"column":23},"end":{"row":145,"column":24}},"text":"1"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":145,"column":23},"end":{"row":145,"column":24}},"text":"5"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":145,"column":24},"end":{"row":145,"column":25}},"text":"0"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":149,"column":0},"end":{"row":149,"column":5}},"text":"    }"},{"action":"removeLines","range":{"start":{"row":144,"column":0},"end":{"row":149,"column":0}},"nl":"\n","lines":["        this.submitSurface = new Surface({","            size: [50, 50],","            content: '<button>Remove!</button>'","            ","        });"]},{"action":"removeText","range":{"start":{"row":143,"column":4},"end":{"row":143,"column":30}},"text":"function submitSurface() {"},{"action":"removeText","range":{"start":{"row":143,"column":4},"end":{"row":144,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":143,"column":4},"end":{"row":144,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":143,"column":4},"end":{"row":144,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":143,"column":4},"end":{"row":143,"column":8}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":143,"column":4},"end":{"row":143,"column":5}},"text":"C"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":143,"column":4},"end":{"row":143,"column":5}},"text":"C"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":68,"column":38},"end":{"row":68,"column":43}},"text":"\"blah"},{"action":"insertText","range":{"start":{"row":68,"column":38},"end":{"row":68,"column":39}},"text":"\""}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":38},"end":{"row":68,"column":39}},"text":"M"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":39},"end":{"row":68,"column":40}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":40},"end":{"row":68,"column":41}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":41},"end":{"row":68,"column":42}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":42},"end":{"row":68,"column":43}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":68,"column":42},"end":{"row":68,"column":43}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":68,"column":41},"end":{"row":68,"column":42}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":68,"column":40},"end":{"row":68,"column":41}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":68,"column":39},"end":{"row":68,"column":40}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":68,"column":38},"end":{"row":68,"column":39}},"text":"M"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":38},"end":{"row":68,"column":39}},"text":"D"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":39},"end":{"row":68,"column":40}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":40},"end":{"row":68,"column":41}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":41},"end":{"row":68,"column":42}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":42},"end":{"row":68,"column":43}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":43},"end":{"row":68,"column":44}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":44},"end":{"row":68,"column":45}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":45},"end":{"row":68,"column":46}},"text":"w"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":46},"end":{"row":68,"column":47}},"text":"("}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":47},"end":{"row":68,"column":48}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":48},"end":{"row":68,"column":49}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":49},"end":{"row":68,"column":50}},"text":"+"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":68,"column":50},"end":{"row":68,"column":51}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"/"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"/"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"_"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"C"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"c"},{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"("}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":22,"column":8},"end":{"row":22,"column":9}},"text":";"}]}]]},"ace":{"folds":[],"scrolltop":1432,"scrollleft":0,"selection":{"start":{"row":119,"column":12},"end":{"row":125,"column":36},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":471,"mode":"ace/mode/javascript"}},"timestamp":1403392333000}